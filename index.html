<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartImóveis - Dashboard Moderno</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f9fafb;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            padding: 20px;
            color: #d32f2f;
            background: #ffebee;
            border-radius: 8px;
            margin: 20px;
            border: 1px solid #ffcdd2;
            max-width: 600px;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
            <h2>Carregando SmartImóveis Dashboard...</h2>
            <div id="status" class="status">Verificando dependências...</div>
        </div>
    </div>

    <script>
        let statusDiv = document.getElementById('status');
        
        function updateStatus(message) {
            console.log(message);
            statusDiv.textContent = message;
        }
        
        function showError(message) {
            document.getElementById('root').innerHTML = `
                <div class="loading">
                    <div class="error-message">
                        <h3>❌ Erro ao carregar o dashboard</h3>
                        <p><strong>Erro:</strong> ${message}</p>
                        <p>Verifique o console do navegador para mais detalhes.</p>
                        <button onclick="location.reload()" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">Tentar Novamente</button>
                    </div>
                </div>
            `;
        }
        
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    updateStatus(`✅ ${src} carregado`);
                    resolve();
                };
                script.onerror = (error) => {
                    updateStatus(`❌ Erro ao carregar ${src}`);
                    reject(new Error(`Falha ao carregar ${src}`));
                };
                document.head.appendChild(script);
            });
        }
        
        async function initializeApp() {
            try {
                // Verificar dependências externas
                updateStatus('Verificando React...');
                if (typeof React === 'undefined') {
                    throw new Error('React não foi carregado');
                }
                
                updateStatus('Verificando ReactDOM...');
                if (typeof ReactDOM === 'undefined') {
                    throw new Error('ReactDOM não foi carregado');
                }
                
                updateStatus('Verificando Supabase...');
                if (typeof supabase === 'undefined') {
                    throw new Error('Supabase não foi carregado');
                }
                
                updateStatus('✅ Dependências externas OK!');
                
                // Carregar scripts locais sequencialmente
                updateStatus('Carregando supabase-config.js...');
                await loadScript('supabase-config.js');
                
                updateStatus('Carregando supabase-services.js...');
                await loadScript('supabase-services.js');
                
                updateStatus('Carregando dashboard-supabase.js...');
                await loadScript('dashboard-supabase.js');
                
                // Aguardar um pouco para garantir que tudo foi processado
                updateStatus('Aguardando inicialização...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Verificar se o componente está disponível
                if (typeof window.DashboardSupabase !== 'function') {
                    throw new Error('Componente DashboardSupabase não encontrado');
                }
                
                updateStatus('✅ Renderizando dashboard...');
                
                // Renderizar o dashboard
                const { createRoot } = ReactDOM;
                const rootElement = document.getElementById('root');
                const root = createRoot(rootElement);
                
                root.render(React.createElement(window.DashboardSupabase));
                
                updateStatus('✅ Dashboard carregado com sucesso!');
                
            } catch (error) {
                console.error('Erro na inicialização:', error);
                showError(error.message);
            }
        }
        
        // Aguardar carregamento da página
        window.addEventListener('load', () => {
            setTimeout(initializeApp, 500);
        });
    </script>
</body>
</html>